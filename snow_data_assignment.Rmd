---
title: "Snow Data Assignment: Web Scraping, Functions, and Iteration"
author: "Kaydee Barker"
date: "2/7/2022"
output: html_document
---

```{r setup, include=FALSE}
library(rvest)
library(tidyverse)
library(lubridate)
library(readxl)

```


# Assignment:

1. Extract the meteorological data URLs. Here we want you to use the `rvest` package to get the URLs for the `SASP forcing` and `SBSP_forcing` meteorological datasets.

```{r, warning=FALSE, echo=FALSE, message=FALSE}

# Read HTML page 
snowarchive <- read_html("https://snowstudies.org/archived-data/")

# Read link with specific pattern
links <- snowarchive %>%
  html_nodes('a') %>%
  .[grepl('forcing',.)] %>%
  html_attr('href')

links # view

```

2. Download the meteorological data. Use the `download_file` and `str_split_fixed` commands to download the data and save it in your data folder. You can use a for loop or a map function. 

```{r, warning=FALSE, echo=FALSE, message=FALSE}

# Grab only the name of the file by splitting out on forward slashes
splits <- str_split_fixed(links,'/',8)

#Keep only the 8th column
files <- splits[,8] 

files

# Generate a file list for where the data goes
file_names <- paste0('data/', files)

# For loop that downloads each - i for every instance, length function tells how many instances
for(i in 1:length(file_names)){
  download.file(links[i],destfile=file_names[i])
}

# Download via map function
#map2(links, file_names, download.file)

# Map version of the for loop (downloading files)
downloaded <- file.exists(file_names) 
evaluate <- !all(downloaded) # sees if files are downloaded (T/F)
if(evaluate == T){
  map2(links[1:2],file_names[1:2],download.file)
}else{print('data downloaded')}

```

3. Write a custom function to read in the data and append a site column to the data. 

```{r, warning=FALSE, echo=FALSE, message=FALSE}



```

4. Use the `map` function to read in both meteorological files. Display a summary of your tibble.

```{r, warning=FALSE, echo=FALSE, message=FALSE}

```

5. Make a line plot of mean temp by year by site (using the `air temp [K]` variable). Is there anything suspicious in the plot? Adjust your filtering if needed.

```{r, warning=FALSE, echo=FALSE, message=FALSE}

```

6. Write a function that makes line plots of monthly average temperature at each site for a given year. Use a for loop to make these plots for 2005 to 2010. Are monthly average temperatures at the Senator Beck Study Plot ever warmer than the Snow Angel Study Plot?
Hint: https://ggplot2.tidyverse.org/reference/print.ggplot.html

```{r, warning=FALSE, echo=FALSE, message=FALSE}

```

Bonus: Make a plot of average daily precipitation by day of year (averaged across all available years)

```{r, warning=FALSE, echo=FALSE, message=FALSE}

```

Bonus #2: Use a function and for loop to create yearly plots of precipitation by day of year

```{r, warning=FALSE, echo=FALSE, message=FALSE}

```
